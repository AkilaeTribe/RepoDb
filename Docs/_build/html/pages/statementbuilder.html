

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>StatementBuilder &mdash; RepoDb 1.1.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Performance" href="performance.html" />
    <link rel="prev" title="Trace" href="trace.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> RepoDb
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="attributes.html">Attributes</a></li>
<li class="toctree-l1"><a class="reference internal" href="typemapping.html">Type Mapping</a></li>
<li class="toctree-l1"><a class="reference internal" href="field.html">Field</a></li>
<li class="toctree-l1"><a class="reference internal" href="orderfield.html">OrderField</a></li>
<li class="toctree-l1"><a class="reference internal" href="connection.html">Connection</a></li>
<li class="toctree-l1"><a class="reference internal" href="rawsql.html">Raw SQL</a></li>
<li class="toctree-l1"><a class="reference internal" href="dbhelper.html">DB Helper</a></li>
<li class="toctree-l1"><a class="reference internal" href="hints.html">Hints</a></li>
<li class="toctree-l1"><a class="reference internal" href="provideroperation.html">Provider Operation</a></li>
<li class="toctree-l1"><a class="reference internal" href="transaction.html">Transaction</a></li>
<li class="toctree-l1"><a class="reference internal" href="querygroup.html">QueryGroup</a></li>
<li class="toctree-l1"><a class="reference internal" href="repository.html">Repository</a></li>
<li class="toctree-l1"><a class="reference internal" href="persistency.html">Persistency</a></li>
<li class="toctree-l1"><a class="reference internal" href="cache.html">Cache</a></li>
<li class="toctree-l1"><a class="reference internal" href="trace.html">Trace</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">StatementBuilder</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#querybuilder">QueryBuilder</a></li>
<li class="toctree-l2"><a class="reference internal" href="#createbatchquery">CreateBatchQuery</a></li>
<li class="toctree-l2"><a class="reference internal" href="#createcount">CreateCount</a></li>
<li class="toctree-l2"><a class="reference internal" href="#createcountall">CreateCountAll</a></li>
<li class="toctree-l2"><a class="reference internal" href="#createdelete">CreateDelete</a></li>
<li class="toctree-l2"><a class="reference internal" href="#createdeleteall">CreateDeleteAll</a></li>
<li class="toctree-l2"><a class="reference internal" href="#createinsert">CreateInsert</a></li>
<li class="toctree-l2"><a class="reference internal" href="#createinsertall">CreateInsertAll</a></li>
<li class="toctree-l2"><a class="reference internal" href="#createmerge">CreateMerge</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id1">CreateMerge</a></li>
<li class="toctree-l2"><a class="reference internal" href="#createquery">CreateQuery</a></li>
<li class="toctree-l2"><a class="reference internal" href="#createqueryall">CreateQueryAll</a></li>
<li class="toctree-l2"><a class="reference internal" href="#createtruncate">CreateTruncate</a></li>
<li class="toctree-l2"><a class="reference internal" href="#createupdate">CreateUpdate</a></li>
<li class="toctree-l2"><a class="reference internal" href="#createupdateall">CreateUpdateAll</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cutomizing-a-builder">Cutomizing a Builder</a></li>
<li class="toctree-l2"><a class="reference internal" href="#sqldbstatementmapper">SqlDbStatementMapper</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="performance.html">Performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="extensibility.html">Extensibility</a></li>
<li class="toctree-l1"><a class="reference internal" href="support.html">Supported Versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="contact.html">Contacts</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">RepoDb</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>StatementBuilder</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/pages/statementbuilder.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="statementbuilder">
<h1>StatementBuilder<a class="headerlink" href="#statementbuilder" title="Permalink to this headline">¶</a></h1>
<p>The library supports statement building injection, allowing the developers to override the default query statement the library is using. By default, the library is using the <cite>SqlDbStatementBuilder</cite> that is only working for SQL Server databases.</p>
<div class="section" id="querybuilder">
<h2>QueryBuilder<a class="headerlink" href="#querybuilder" title="Permalink to this headline">¶</a></h2>
<p>A query builder is an helper object used when creating a query statement in the statement builders. It contains important methods that is very useful to fluently construct the statement.</p>
<p>Below is a sample code that creates a SQL Statement for the <cite>Query</cite> operation for <cite>Oracle</cite> data provider.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>public string CreateQuery(QueryBuilder queryBuilder,
string tableName,
IEnumerable&lt;Field&gt; fields,
QueryGroup where = null,
IEnumerable&lt;OrderField&gt; orderBy = null,
int? top = null,
string hints = null)
{
        // There should be fields
        if (fields == null || fields.Any() == false)
        {
                throw new NullReferenceException($&quot;The list of queryable fields must not be null for &#39;{tableName}&#39;.&quot;);
        }

        // Build the query
        queryBuilder
                .Clear()
                .Select()
                .TopFrom(top)
                .FieldsFrom(fields)
                .From()
                .TableNameFrom(tableName);

        // Build the query optimizers
        if (hints != null)
        {
                // Write the hints here like: queryBuilder.WriteText(hints);
        }

        // Add all fields for WHERE
        if (where != null)
        {
                queryBuilder.WhereFrom(where);
        }

        // Add the ROWNUM (TOP in SQL Server)
        if (top &gt; 0)
        {
                // In Oracle, SELECT [Fields] FROM [Table] WHERE [Fields] AND ROWNUM &lt;=(Rows)
                if (where != null)
                {
                        queryBuilder.WriteText($&quot;AND (ROWNUM &lt;= {top})&quot;);
                }
                else
                {
                        queryBuilder.WriteText($&quot;(ROWNUM &lt;= {top})&quot;);
                }
        }

        // Build the filter and ordering
        queryBuilder
                .OrderByFrom(orderBy)
                .End();

        // Return the query
        return queryBuilder.GetString();
}
</pre></div>
</div>
</div>
<div class="section" id="createbatchquery">
<h2>CreateBatchQuery<a class="headerlink" href="#createbatchquery" title="Permalink to this headline">¶</a></h2>
<p>This method is used to compose a SQL statement for <cite>BatchQuery</cite> operation.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>public string CreateBatchQuery(QueryBuilder queryBuilder,
        string tableName,
        IEnumerable&lt;Field&gt; fields,
        int page,
        int rowsPerBatch,
        IEnumerable&lt;OrderField&gt; orderBy = null,
        QueryGroup where = null,
        string hints = null)
{
        ...
}
</pre></div>
</div>
</div>
<div class="section" id="createcount">
<h2>CreateCount<a class="headerlink" href="#createcount" title="Permalink to this headline">¶</a></h2>
<p>This method is used to compose a SQL statement for <cite>Count</cite> operation.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>public string CreateCount(QueryBuilder queryBuilder,
        string tableName,
        QueryGroup where = null,
        string hints = null)
{
        ...
}
</pre></div>
</div>
</div>
<div class="section" id="createcountall">
<h2>CreateCountAll<a class="headerlink" href="#createcountall" title="Permalink to this headline">¶</a></h2>
<p>This method is used to compose a SQL statement for <cite>CountAll</cite> operation.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>public string CreateCountAll(QueryBuilder queryBuilder,
        string tableName,
        string hints = null)
{
        ...
}
</pre></div>
</div>
</div>
<div class="section" id="createdelete">
<h2>CreateDelete<a class="headerlink" href="#createdelete" title="Permalink to this headline">¶</a></h2>
<p>This method is used to compose a SQL statement for <cite>Delete</cite> operation.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>public string CreateDelete(QueryBuilder queryBuilder,
        string tableName,
        QueryGroup where = null)
{
        ...
}
</pre></div>
</div>
</div>
<div class="section" id="createdeleteall">
<h2>CreateDeleteAll<a class="headerlink" href="#createdeleteall" title="Permalink to this headline">¶</a></h2>
<p>This method is used to compose a SQL statement for <cite>DeleteAll</cite> operation.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>public string CreateDeleteAll(QueryBuilder queryBuilder,
        string tableName)
{
        ...
}
</pre></div>
</div>
</div>
<div class="section" id="createinsert">
<h2>CreateInsert<a class="headerlink" href="#createinsert" title="Permalink to this headline">¶</a></h2>
<p>This method is used to compose a SQL statement for <cite>Insert</cite> operation.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>public string CreateInsert(QueryBuilder queryBuilder,
        string tableName,
        IEnumerable&lt;Field&gt; fields = null,
        DbField primaryField = null,
        DbField identityField = null)
{
        ...
}
</pre></div>
</div>
</div>
<div class="section" id="createinsertall">
<h2>CreateInsertAll<a class="headerlink" href="#createinsertall" title="Permalink to this headline">¶</a></h2>
<p>This method is used to compose a SQL statement for <cite>InsertAll</cite> operation.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>public string CreateInsertAll(QueryBuilder queryBuilder,
        string tableName,
        IEnumerable&lt;Field&gt; fields = null,
        int batchSize = Constant.DefaultBatchOperationSize,
        DbField primaryField = null,
        DbField identityField = null)
{
        ...
}
</pre></div>
</div>
</div>
<div class="section" id="createmerge">
<h2>CreateMerge<a class="headerlink" href="#createmerge" title="Permalink to this headline">¶</a></h2>
<p>This method is used to compose a SQL statement for <cite>Merge</cite> operation.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>public string CreateMerge(QueryBuilder queryBuilder,
        string tableName,
        IEnumerable&lt;Field&gt; fields,
        IEnumerable&lt;Field&gt; qualifiers = null,
        DbField primaryField = null,
        DbField identityField = null)
{
        ...
}
</pre></div>
</div>
</div>
<div class="section" id="id1">
<h2>CreateMerge<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>This method is used to compose a SQL statement for <cite>MergeAll</cite> operation.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>public string CreateMergeAll(QueryBuilder queryBuilder,
        string tableName,
        IEnumerable&lt;Field&gt; fields,
        IEnumerable&lt;Field&gt; qualifiers,
        int batchSize = Constant.DefaultBatchOperationSize,
        DbField primaryField = null,
        DbField identityField = null)
{
        ...
}
</pre></div>
</div>
</div>
<div class="section" id="createquery">
<h2>CreateQuery<a class="headerlink" href="#createquery" title="Permalink to this headline">¶</a></h2>
<p>This method is used to compose a SQL statement for <cite>Query</cite> operation.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>public string CreateQuery(QueryBuilder queryBuilder,
        string tableName,
        IEnumerable&lt;Field&gt; fields,
        QueryGroup where = null,
        IEnumerable&lt;OrderField&gt; orderBy = null,
        int? top = null,
        string hints = null)
{
        ...
}
</pre></div>
</div>
</div>
<div class="section" id="createqueryall">
<h2>CreateQueryAll<a class="headerlink" href="#createqueryall" title="Permalink to this headline">¶</a></h2>
<p>This method is used to compose a SQL statement for <cite>QueryAll</cite> operation.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>public string CreateQueryAll(QueryBuilder queryBuilder,
        string tableName,
        IEnumerable&lt;Field&gt; fields,
        IEnumerable&lt;OrderField&gt; orderBy = null,
        string hints = null)
{
        ...
}
</pre></div>
</div>
</div>
<div class="section" id="createtruncate">
<h2>CreateTruncate<a class="headerlink" href="#createtruncate" title="Permalink to this headline">¶</a></h2>
<p>This method is used to compose a SQL statement for <cite>Truncate</cite> operation.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>public string CreateTruncate(QueryBuilder queryBuilder,
        string tableName)
{
        ...
}
</pre></div>
</div>
</div>
<div class="section" id="createupdate">
<h2>CreateUpdate<a class="headerlink" href="#createupdate" title="Permalink to this headline">¶</a></h2>
<p>This method is used to compose a SQL statement for <cite>Update</cite> operation.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>public string CreateUpdate(QueryBuilder queryBuilder,
        string tableName,
        IEnumerable&lt;Field&gt; fields,
        QueryGroup where = null,
        DbField primaryField = null,
        DbField identityField = null)
{
        ...
}
</pre></div>
</div>
</div>
<div class="section" id="createupdateall">
<h2>CreateUpdateAll<a class="headerlink" href="#createupdateall" title="Permalink to this headline">¶</a></h2>
<p>This method is used to compose a SQL statement for <cite>UpdateAll</cite> operation.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>public string CreateUpdateAll(QueryBuilder queryBuilder,
        string tableName,
        IEnumerable&lt;Field&gt; fields,
        IEnumerable&lt;Field&gt; qualifiers,
        int batchSize = Constant.DefaultBatchOperationSize,
        DbField primaryField = null,
        DbField identityField = null)
{
        ...
}
</pre></div>
</div>
</div>
<div class="section" id="cutomizing-a-builder">
<h2>Cutomizing a Builder<a class="headerlink" href="#cutomizing-a-builder" title="Permalink to this headline">¶</a></h2>
<p>The main reason why the library supports the statement builder is to allow the developers override the default statement builder of the library. By default, the library statement builder is only limited for SQL Server providers (as SQL Statements). However, it will fail if the library is being used to access the Oracle, MySql or any other providers.</p>
<p>To create a custom statement builder, simply create a class and implements the <cite>Interfaces.IStatementBuilder</cite> interface.</p>
<div class="highlight-c# notranslate"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">class</span> <span class="nc">OracleDbStatementBuilder</span> <span class="p">:</span> <span class="n">IStatementBuilder</span>
<span class="p">{</span>
        <span class="c1">// Implements the IStatementBuilder methods here</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Once the custom statement builder is created, it then can be used as an injectable object into the repository. See sample below injecting a statement builder for Oracle provider.</p>
<div class="highlight-c# notranslate"><div class="highlight"><pre><span></span><span class="kt">var</span> <span class="n">statementBuilder</span> <span class="p">=</span> <span class="k">new</span> <span class="n">OracleDbStatementBuilder</span><span class="p">();</span>
<span class="kt">var</span> <span class="n">repository</span> <span class="p">=</span> <span class="k">new</span> <span class="n">DbRepository</span><span class="p">&lt;</span><span class="n">SqlConnection</span><span class="p">&gt;(</span><span class="s">@&quot;Server=.;Database=Northwind;Integrated Security=SSPI;&quot;</span><span class="p">,</span> <span class="n">statementBuilder</span><span class="p">);</span>
</pre></div>
</div>
<p>With the code snippets above, everytime the repository operation methods is being called, the <cite>OracleStatementBuilder</cite> corresponding method will be executed.</p>
</div>
<div class="section" id="sqldbstatementmapper">
<h2>SqlDbStatementMapper<a class="headerlink" href="#sqldbstatementmapper" title="Permalink to this headline">¶</a></h2>
<p>By default, the library has mapped the <cite>SqlDbStatementBuilder</cite> object for the statement building. This means that library has fully supported the SQL Server DB Provider. With this class, a custom <cite>IStatementBuilder</cite> object can be injected as a statement builder for the <cite>Repositories</cite> and other <cite>DbConnection</cite> extended methods.</p>
<p>The mapper is of static type <cite>StatementBuilderMapper</cite>.</p>
<p>Let say for example, the developers created the following repositories:</p>
<blockquote>
<div><ul class="simple">
<li>CustomerRepository (for <cite>SqlConnection</cite>)</li>
<li>ProductRepository (for <cite>SqlConnection</cite>)</li>
<li>OrderRepository (for <cite>OracleConnection</cite>)</li>
<li>CompanyRepository (for <cite>OleDbConnection</cite>)</li>
</ul>
</div></blockquote>
<p>With the following repositories defined above, the developers must implement atleast two (2) custom statement builder (one for Oracle provider and one for OleDb provider).</p>
<blockquote>
<div><ul class="simple">
<li>OracleStatementBuilder</li>
<li>OleDbStatementBuilder</li>
</ul>
</div></blockquote>
<p>Then, by mapping a custom statement builders, it will enable the library to re-use the instance of the statement builder mapped into the desired DB provider. This feature works to both <cite>Repositories</cite> and <cite>DbConnection</cite> extended methods.</p>
<div class="highlight-c# notranslate"><div class="highlight"><pre><span></span><span class="n">StatementBuilderMapper</span><span class="p">.</span><span class="n">Map</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">OracleConnection</span><span class="p">),</span> <span class="k">new</span> <span class="n">OracleStatementBuilder</span><span class="p">());</span>
<span class="n">StatementBuilderMapper</span><span class="p">.</span><span class="n">Map</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">OleDbConnection</span><span class="p">),</span> <span class="k">new</span> <span class="n">OleDbStatementBuilder</span><span class="p">());</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="performance.html" class="btn btn-neutral float-right" title="Performance" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="trace.html" class="btn btn-neutral float-left" title="Trace" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Michael Camara Pendon

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>